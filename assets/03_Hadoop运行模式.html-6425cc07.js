import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as l,c as i,b as a,d as s,e,a as t}from"./app-9a860c23.js";const c={},d={href:"http://hadoop.apache.org/",target:"_blank",rel:"noopener noreferrer"},u=t(`<p>2）Hadoop运行模式包括：本地模式、伪分布式模式以及完全分布式模式。</p><ul><li>本地模式：单机运行，只是用来演示一下官方案例。生产环境不用。</li><li>伪分布式模式：也是单机运行，但是具备Hadoop集群的所有功能，一台服务器模拟一个分布式的环境。个别缺钱的公司用来测试，生产环境不用。</li><li>完全分布式模式：多台服务器组成分布式环境。生产环境使用。</li></ul><h2 id="_3-1-本地运行模式-官方wordcount" tabindex="-1"><a class="header-anchor" href="#_3-1-本地运行模式-官方wordcount" aria-hidden="true">#</a> 3.1 本地运行模式（官方WordCount）</h2><p>1）创建在hadoop-3.1.3文件下面创建一个wcinput文件夹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> wcinput
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）在wcinput文件下创建一个word.txt文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> wcinput
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）编辑word.txt文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 wcinput<span class="token punctuation">]</span>$ <span class="token function">vim</span> word.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>在文件中输入如下内容</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>hadoop <span class="token function">yarn</span>
hadoop mapreduce
atguigu
atguigu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>保存退出：<code>:wq</code></li></ul><p>4）回到Hadoop目录/opt/module/hadoop-3.1.3</p><p>5）执行程序</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount wcinput wcoutput
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>6）查看结果</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ <span class="token function">cat</span> wcoutput/part-r-00000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>看到如下结果：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>atguigu <span class="token number">2</span>
hadoop  <span class="token number">2</span>
mapreduce       <span class="token number">1</span>
<span class="token function">yarn</span>    <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2-完全分布式运行模式-开发重点" tabindex="-1"><a class="header-anchor" href="#_3-2-完全分布式运行模式-开发重点" aria-hidden="true">#</a> 3.2 完全分布式运行模式（开发重点）</h2><p>分析：</p><p>1）准备3台客户机（关闭防火墙、静态IP、主机名称）</p><p>2）安装JDK</p><p>3）配置环境变量</p><p>4）安装Hadoop</p><p>5）配置环境变量</p><p>6）配置集群</p><p>7）单点启动</p><p>8）配置ssh</p><p>9）群起并测试集群</p><h3 id="_3-2-1-虚拟机准备" tabindex="-1"><a class="header-anchor" href="#_3-2-1-虚拟机准备" aria-hidden="true">#</a> 3.2.1 虚拟机准备</h3><p>详见2.1、2.2两节。</p><h3 id="_3-2-2-编写集群分发脚本xsync" tabindex="-1"><a class="header-anchor" href="#_3-2-2-编写集群分发脚本xsync" aria-hidden="true">#</a> 3.2.2 编写集群分发脚本xsync</h3><p>1）scp（secure copy）安全拷贝</p><p>（1）scp定义</p><p>scp可以实现服务器与服务器之间的数据拷贝。（from server1 to server2）</p><p>（2）基本语法</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">scp</span> <span class="token parameter variable">-r</span> <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$user</span>@<span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$pdir</span>/<span class="token variable">$fname</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>命令 递归 要拷贝的文件路径/名称 目的地用户@主机:目的地路径/名称</p><p>（3）案例实操</p><ul><li>前提：在hadoop102、hadoop103、hadoop104都已经创建好的/opt/module、 /opt/software两个目录，并且已经把这两个目录修改为atguigu:atguigu</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">chown</span> atguigu:atguigu <span class="token parameter variable">-R</span> /opt/module
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（a）在hadoop102上，将hadoop102中/opt/module/jdk1.8.0_212目录拷贝到hadoop103上。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token parameter variable">-r</span> /opt/module/jdk1.8.0<span class="token punctuation">\\</span>_212  atguigu@hadoop103:/opt/module
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（b）在hadoop103上，将hadoop102中/opt/module/hadoop-3.1.3目录拷贝到hadoop103上。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token parameter variable">-r</span> atguigu@hadoop102:/opt/module/hadoop-3.1.3 /opt/module/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（c）在hadoop103上操作，将hadoop102中/opt/module目录下所有目录拷贝到hadoop104上。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 opt<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token parameter variable">-r</span> atguigu@hadoop102:/opt/module/<span class="token punctuation">\\</span>* atguigu@hadoop104:/opt/module
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）rsync远程同步工具</p><p>rsync主要用于备份和镜像。具有速度快、避免复制相同内容和支持符号链接的优点。</p><p>rsync和scp区别：用rsync做文件的复制要比scp的速度快，rsync只对差异文件做更新。scp是把所有文件都复制过去。</p><p>（1）基本语法</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rsync</span> <span class="token parameter variable">-av</span> <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$user</span>@<span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$pdir</span>/<span class="token variable">$fname</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>命令 选项参数 要拷贝的文件路径/名称 目的地用户@主机:目的地路径/名称</p><p>选项参数说明</p><table><thead><tr><th>选项</th><th>功能</th></tr></thead><tbody><tr><td>-a</td><td>归档拷贝</td></tr><tr><td>-v</td><td>显示复制过程</td></tr></tbody></table><p>（2）案例实操</p><p>（a）删除hadoop103中/opt/module/hadoop-3.1.3/wcinput</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 hadoop-3.1.3<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> wcinput/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（b）同步hadoop102中的/opt/module/hadoop-3.1.3到hadoop103</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 module<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-av</span> hadoop-3.1.3/ atguigu@hadoop103:/opt/module/hadoop-3.1.3/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）xsync集群分发脚本</p><p>（1）需求：循环复制文件到所有节点的相同目录下</p><p>（2）需求分析：</p><p>（a）rsync命令原始拷贝：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rsync</span>  <span class="token parameter variable">-av</span>     /opt/module  		 atguigu@hadoop103:/opt/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（b）期望脚本：</p><p>xsync要同步的文件名称</p><p>（c）期望脚本在任何路径都能使用（脚本放在声明了全局环境变量的路径）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>
/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/atguigu/.local/bin:/home/atguigu/bin:/opt/module/jdk1.8.0<span class="token punctuation">\\</span>_212/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）脚本实现</p><p>（a）在/home/atguigu/bin目录下创建xsync文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 opt<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /home/atguigu
<span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> bin
<span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> bin
<span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> xsync
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在该文件中编写如下代码</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#1. 判断参数个数</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-lt</span> <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> Not Enough Arguement<span class="token operator">!</span>
    <span class="token builtin class-name">exit</span><span class="token punctuation">;</span>
<span class="token keyword">fi</span>

<span class="token comment">#2. 遍历集群所有机器</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>  <span class="token variable">$host</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
    <span class="token comment">#3. 遍历所有目录，挨个发送</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">$@</span>
    <span class="token keyword">do</span>
        <span class="token comment">#4. 判断文件是否存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> <span class="token variable">$file</span> <span class="token punctuation">]</span>
            <span class="token keyword">then</span>
                <span class="token comment">#5. 获取父目录</span>
                <span class="token assign-left variable">pdir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> <span class="token parameter variable">-P</span> <span class="token punctuation">$(</span>dirname $file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
                
                <span class="token comment">#6. 获取当前文件的名称</span>
                <span class="token assign-left variable">fname</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $file<span class="token variable">)</span></span>
                <span class="token function">ssh</span> <span class="token variable">$host</span> <span class="token string">&quot;mkdir -p <span class="token variable">$pdir</span>&quot;</span>
                <span class="token function">rsync</span> <span class="token parameter variable">-av</span> <span class="token variable">$pdir</span>/<span class="token variable">$fname</span> <span class="token variable">$host</span><span class="token builtin class-name">:</span><span class="token variable">$pdir</span>
            <span class="token keyword">else</span>
                <span class="token builtin class-name">echo</span> <span class="token variable">$file</span> does not exists<span class="token operator">!</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（b）修改脚本 xsync 具有执行权限</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> +x xsync
// 例如：
<span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token number">777</span> xsync
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（c）测试脚本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ xsync /home/atguigu/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（d）将脚本复制到/bin中，以便全局调用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">cp</span> xsync /bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（e）同步环境变量配置（root所有者）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> ./bin/xsync /etc/profile.d/my<span class="token punctuation">\\</span>_env.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：如果用了sudo，那么xsync一定要给它的路径补全。</p><p>让环境变量生效</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 bin<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
<span class="token punctuation">[</span>atguigu@hadoop104 opt<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-3-ssh无密登录配置" tabindex="-1"><a class="header-anchor" href="#_3-2-3-ssh无密登录配置" aria-hidden="true">#</a> 3.2.3 SSH无密登录配置</h3><p>1）配置ssh</p><p>（1）基本语法</p><p>ssh另一台电脑的IP地址</p><p>（2）ssh连接时出现Host key verification failed的解决方法</p><p>[atguigu@hadoop102 ~]$ ssh hadoop103</p><ul><li>如果出现如下内容</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>输入yes，并回车</li></ul><p>（3）退回到hadoop102</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）无密钥配置</p><p>（1）免密登录原理</p><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119015900.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>（2）生成公钥和私钥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 .ssh<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span>
/home/atguigu/.ssh
<span class="token punctuation">[</span>atguigu@hadoop102 .ssh<span class="token punctuation">]</span>$ ssh-keygen <span class="token parameter variable">-t</span> rsa
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后敲（三个回车），就会生成两个文件id_rsa（私钥）、id_rsa.pub（公钥）</p><p>（3）将公钥拷贝到要免密登录的目标机器上</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 .ssh<span class="token punctuation">]</span>$ ssh-copy-id hadoop102
<span class="token punctuation">[</span>atguigu@hadoop102 .ssh<span class="token punctuation">]</span>$ ssh-copy-id hadoop103
<span class="token punctuation">[</span>atguigu@hadoop102 .ssh<span class="token punctuation">]</span>$ ssh-copy-id hadoop104
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><p>还需要在hadoop103上采用atguigu账号配置一下无密登录到hadoop102、hadoop103、hadoop104服务器上。</p><p>还需要在hadoop104上采用atguigu账号配置一下无密登录到hadoop102、hadoop103、hadoop104服务器上。</p><p>还需要在hadoop102上采用root账号，配置一下无密登录到hadoop102、hadoop103、hadoop104；</p><p>3）.ssh文件夹下（~/.ssh）的文件功能解释</p><table><thead><tr><th>known_hosts</th><th>记录ssh访问过计算机的公钥（public key）</th></tr></thead><tbody><tr><td>id_rsa</td><td>生成的私钥</td></tr><tr><td>id_rsa.pub</td><td>生成的公钥</td></tr><tr><td>authorized_keys</td><td>存放授权过的无密登录服务器公钥</td></tr></tbody></table><h3 id="_3-2-4-集群配置" tabindex="-1"><a class="header-anchor" href="#_3-2-4-集群配置" aria-hidden="true">#</a> 3.2.4 集群配置</h3><p>1）集群部署规划</p><p>注意：</p><ul><li>NameNode和SecondaryNameNode不要安装在同一台服务器</li><li>ResourceManager也很消耗内存，不要和NameNode、SecondaryNameNode配置在同一台机器上。</li></ul><table><thead><tr><th></th><th>hadoop102</th><th>hadoop103</th><th>hadoop104</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode<br>DataNode</td><td>DataNode</td><td>SecondaryNameNode<br>DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager<br>NodeManager</td><td>NodeManager</td></tr></tbody></table><p>2）配置文件说明</p><p>Hadoop配置文件分两类：默认配置文件和自定义配置文件，只有用户想修改某一默认配置值时，才需要修改自定义配置文件，更改相应属性值。</p><p>（1）默认配置文件：</p><table><thead><tr><th>要获取的默认文件</th><th>文件存放在Hadoop的jar包中的位置</th></tr></thead><tbody><tr><td>[core-default.xml]</td><td>hadoop-common-3.1.3.jar/core-default.xml</td></tr><tr><td>[hdfs-default.xml]</td><td>hadoop-hdfs-3.1.3.jar/hdfs-default.xml</td></tr><tr><td>[yarn-default.xml]</td><td>hadoop-yarn-common-3.1.3.jar/yarn-default.xml</td></tr><tr><td>[mapred-default.xml]</td><td>hadoop-mapreduce-client-core-3.1.3.jar/mapred-default.xml</td></tr></tbody></table><p>（2）自定义配置文件：</p><p>core-site.xml、hdfs-site.xml、yarn-site.xml、mapred-site.xml四个配置文件存放在$HADOOP_HOME/etc/hadoop这个路径上，用户可以根据项目需求重新进行修改配置。</p><p>3）配置集群</p><p>（1）核心配置文件</p><p>配置core-site.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> <span class="token variable">$HADOOP</span><span class="token punctuation">\\</span>_HOME/etc/hadoop
<span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> core-site.xml
\`\`<span class="token variable"><span class="token variable">\`</span>shell

文件内容如下：

<span class="token variable">\`</span></span>\`\`xml
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>?xml-stylesheet <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">&quot;text/xsl&quot;</span> <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;configuration.xsl&quot;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定NameNode的地址 --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>fs.defaultFS<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs://hadoop102:802<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span>-- 指定hadoop数据的存储目录 --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop.tmp.dir<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>/opt/module/hadoop-3.1.3/data<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span>-- 配置HDFS网页登录使用的静态用户为atguigu --<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hadoop.http.staticuser.user<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>atguigu<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）HDFS配置文件</p><p>配置hdfs-site.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> hdfs-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>文件内容如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token prolog">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- nn web端访问地址--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop102:9870<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 2nn web端访问地址--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.secondary.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop104:9868<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）YARN配置文件</p><p>配置yarn-site.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> yarn-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>文件内容如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token prolog">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定MR走shuffle --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce\\_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定ResourceManager的地址--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.hostname<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 环境变量的继承 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.env-whitelist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>JAVA\\_HOME,HADOOP\\_COMMON\\_HOME,HADOOP\\_HDFS\\_HOME,HADOOP\\_CONF\\_DIR,CLASSPATH\\_PREPEND\\_DISTCACHE,HADOOP\\_YARN\\_HOME,HADOOP\\_MAPRED\\_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（4）MapReduce配置文件</p><p>配置mapred-site.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> mapred-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>文件内容如下：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token prolog">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定MapReduce程序运行在Yarn上 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4）在集群上分发配置好的Hadoop配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ xsync /opt/module/hadoop-3.1.3/etc/hadoop/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>5）去103和104上查看文件分发情况</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml
<span class="token punctuation">[</span>atguigu@hadoop104 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-5-群起集群" tabindex="-1"><a class="header-anchor" href="#_3-2-5-群起集群" aria-hidden="true">#</a> 3.2.5 群起集群</h3><p>1）配置workers</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> /opt/module/hadoop-3.1.3/etc/hadoop/workers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在该文件中增加如下内容：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>hadoop102
hadoop103
hadoop104
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：该文件中添加的内容结尾不允许有空格，文件中不允许有空行。</p><p>同步所有节点配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ xsync /opt/module/hadoop-3.1.3/etc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）启动集群</p><p>（1）如果集群是第一次启动，需要在hadoop102节点格式化NameNode（注意：格式化NameNode，会产生新的集群id，导致NameNode和DataNode的集群id不一致，集群找不到已往数据。如果集群在运行过程中报错，需要重新格式化NameNode的话，一定要先停止namenode和datanode进程，并且要删除所有机器的data和logs目录，然后再进行格式化。）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ hdfs namenode <span class="token parameter variable">-format</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（2）启动HDFS</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ sbin/start-dfs.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（3）在配置了ResourceManager的节点（hadoop103）启动YARN</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 hadoop-3.1.3<span class="token punctuation">]</span>$ sbin/start-yarn.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（4）Web端查看HDFS的NameNode</p><p>（a）浏览器中输入：<a href="">http://hadoop102:9870</a></p><p>（b）查看HDFS上存储的数据信息</p><p>（5）Web端查看YARN的ResourceManager</p>`,164),r={href:"http://hadoop103:8088",target:"_blank",rel:"noopener noreferrer"},v=t(`<p>（b）查看YARN上运行的Job信息</p><p>3）集群基本测试</p><p>（1）上传文件到集群</p><ul><li>上传小文件</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-mkdir</span> /input
<span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-put</span> <span class="token variable">$HADOOP</span><span class="token punctuation">\\</span>_HOME/wcinput/word.txt /input
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>上传大文件</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-put</span>  /opt/software/jdk-8u212-linux-x64.tar.gz  /
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（2）上传文件后查看文件存放在什么位置</p><ul><li>查看HDFS文件存储路径</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 subdir0<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span>
/opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1436128598-192.168.10.102-1610603650062/current/finalized/subdir0/subdir0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看HDFS在磁盘存储文件内容</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 subdir0<span class="token punctuation">]</span>$ <span class="token function">cat</span> blk<span class="token punctuation">\\</span>_1073741825
hadoop <span class="token function">yarn</span>
hadoop mapreduce 
atguigu
atguigu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）拼接</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>-rw-rw-r--. <span class="token number">1</span> atguigu atguigu <span class="token number">134217728</span> <span class="token number">5</span>月  <span class="token number">23</span> <span class="token number">16</span>:01 blk<span class="token punctuation">\\</span>_1073741836
-rw-rw-r--. <span class="token number">1</span> atguigu atguigu   <span class="token number">1048583</span> <span class="token number">5</span>月  <span class="token number">23</span> <span class="token number">16</span>:01 blk<span class="token punctuation">\\</span>_1073741836<span class="token punctuation">\\</span>_1012.meta
-rw-rw-r--. <span class="token number">1</span> atguigu atguigu  <span class="token number">63439959</span> <span class="token number">5</span>月  <span class="token number">23</span> <span class="token number">16</span>:01 blk<span class="token punctuation">\\</span>_1073741837
-rw-rw-r--. <span class="token number">1</span> atguigu atguigu    <span class="token number">495635</span> <span class="token number">5</span>月  <span class="token number">23</span> <span class="token number">16</span>:01 blk<span class="token punctuation">\\</span>_1073741837<span class="token punctuation">\\</span>_1013.meta
<span class="token punctuation">[</span>atguigu@hadoop102 subdir0<span class="token punctuation">]</span>$ <span class="token function">cat</span> blk<span class="token punctuation">\\</span>_107374183<span class="token operator"><span class="token file-descriptor important">6</span>&gt;&gt;</span>tmp.tar.gz
<span class="token punctuation">[</span>atguigu@hadoop102 subdir0<span class="token punctuation">]</span>$ <span class="token function">cat</span> blk<span class="token punctuation">\\</span>_107374183<span class="token operator"><span class="token file-descriptor important">7</span>&gt;&gt;</span>tmp.tar.gz
<span class="token punctuation">[</span>atguigu@hadoop102 subdir0<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> tmp.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（4）下载</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop104 software<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-get</span> /jdk-8u212-linux-x64.tar.gz ./
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（5）执行wordcount程序</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-2-6-配置历史服务器" tabindex="-1"><a class="header-anchor" href="#_3-2-6-配置历史服务器" aria-hidden="true">#</a> 3.2.6 配置历史服务器</h3><p>为了查看程序的历史运行情况，需要配置一下历史服务器。具体配置步骤如下：</p><p>1）配置mapred-site.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> mapred-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在该文件里面增加如下配置。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- 历史服务器端地址 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop102:10020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 历史服务器web端地址 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.webapp.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hadoop102:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）分发配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ xsync <span class="token variable">$HADOOP</span><span class="token punctuation">\\</span>_HOME/etc/hadoop/mapred-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）在hadoop102启动历史服务器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ mapred <span class="token parameter variable">--daemon</span> start historyserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>4）查看历史服务器是否启动</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ jps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>5）查看JobHistory</p><p><a href="">http://hadoop102:19888/jobhistory</a></p><h3 id="_3-2-7-配置日志的聚集" tabindex="-1"><a class="header-anchor" href="#_3-2-7-配置日志的聚集" aria-hidden="true">#</a> 3.2.7 配置日志的聚集</h3><p>日志聚集概念：应用运行完成以后，将程序运行日志信息上传到HDFS系统上。</p><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119015931.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>日志聚集功能好处：可以方便的查看到程序运行详情，方便开发调试。</p><p>注意：开启日志聚集功能，需要重新启动NodeManager 、ResourceManager和HistoryServer。</p><p>开启日志聚集功能具体步骤如下：</p><p>1）配置yarn-site.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ <span class="token function">vim</span> yarn-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在该文件里面增加如下配置。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- 开启日志聚集功能 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation-enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 设置日志聚集服务器地址 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log.server.url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>http://hadoop102:19888/jobhistory/logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 设置日志保留时间为7天 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation.retain-seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>604800<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2）分发配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop<span class="token punctuation">]</span>$ xsync <span class="token variable">$HADOOP</span><span class="token punctuation">\\</span>_HOME/etc/hadoop/yarn-site.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）关闭NodeManager 、ResourceManager和HistoryServer</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 hadoop-3.1.3<span class="token punctuation">]</span>$ sbin/stop-yarn.sh
<span class="token punctuation">[</span>atguigu@hadoop103 hadoop-3.1.3<span class="token punctuation">]</span>$ mapred <span class="token parameter variable">--daemon</span> stop historyserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>4）启动NodeManager 、ResourceManage和HistoryServer</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ start-yarn.sh
<span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ mapred <span class="token parameter variable">--daemon</span> start historyserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>5）删除HDFS上已经存在的输出文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-rm</span> <span class="token parameter variable">-r</span> /output
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>6）执行WordCount程序</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 hadoop-3.1.3<span class="token punctuation">]</span>$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>7）查看日志</p><p>（1）历史服务器地址</p>`,54),g={href:"http://hadoop102:19888/jobhistory",target:"_blank",rel:"noopener noreferrer"},m=t(`<p>（2）历史任务列表</p><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119020002.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>（3）查看任务运行日志</p><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119020014.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>（4）运行日志详情</p><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119020035.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-2-8-集群启动-停止方式总结" tabindex="-1"><a class="header-anchor" href="#_3-2-8-集群启动-停止方式总结" aria-hidden="true">#</a> 3.2.8 集群启动/停止方式总结</h3><p>1）各个模块分开启动/停止（配置ssh是前提）常用</p><p>（1）整体启动/停止HDFS</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>start-dfs.sh/stop-dfs.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（2）整体启动/停止YARN</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>start-yarn.sh/stop-yarn.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）各个服务组件逐一启动/停止</p><p>（1）分别启动/停止HDFS组件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>hdfs <span class="token parameter variable">--daemon</span> start/stop namenode/datanode/secondarynamenode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（2）启动/停止YARN</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token parameter variable">--daemon</span> start/stop  resourcemanager/nodemanager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-2-9-编写hadoop集群常用脚本" tabindex="-1"><a class="header-anchor" href="#_3-2-9-编写hadoop集群常用脚本" aria-hidden="true">#</a> 3.2.9 编写Hadoop集群常用脚本</h3>`,18),k={href:"http://myhadoop.sh",target:"_blank",rel:"noopener noreferrer"},b=t(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /home/atguigu/bin
<span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> myhadoop.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>输入如下内容</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-lt</span> <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;No Args Input...&quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token punctuation">;</span>
<span class="token keyword">fi</span>
<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;=================== 启动 hadoop集群 ===================&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------- 启动 hdfs ---------------&quot;</span>
    <span class="token function">ssh</span> hadoop102 <span class="token string">&quot;/opt/module/hadoop-3.1.3/sbin/start-dfs.sh&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------- 启动 yarn ---------------&quot;</span>
    <span class="token function">ssh</span> hadoop103 <span class="token string">&quot;/opt/module/hadoop-3.1.3/sbin/start-yarn.sh&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------- 启动 historyserver ---------------&quot;</span>
    <span class="token function">ssh</span> hadoop102 <span class="token string">&quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver&quot;</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;=================== 关闭 hadoop集群 ===================&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------- 关闭 historyserver ---------------&quot;</span>
    <span class="token function">ssh</span> hadoop102 <span class="token string">&quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------- 关闭 yarn ---------------&quot;</span>
    <span class="token function">ssh</span> hadoop103 <span class="token string">&quot;/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh&quot;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;--------------- 关闭 hdfs ---------------&quot;</span>
    <span class="token function">ssh</span> hadoop102 <span class="token string">&quot;/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh&quot;</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">\\</span>*<span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Input Args Error...&quot;</span>
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>保存后退出，然后赋予脚本执行权限</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> +x myhadoop.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）查看三台服务器Java进程脚本：jpsall</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /home/atguigu/bin
<span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> jpsall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>输入如下内容</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token variable">$host</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
    <span class="token function">ssh</span> <span class="token variable">$host</span> jps 
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>保存后退出，然后赋予脚本执行权限</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> +x jpsall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）分发/home/atguigu/bin目录，保证自定义脚本在三台机器上都可以使用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ xsync /home/atguigu/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-2-10-常用端口号说明" tabindex="-1"><a class="header-anchor" href="#_3-2-10-常用端口号说明" aria-hidden="true">#</a> 3.2.10 常用端口号说明</h3><table><thead><tr><th>端口名称</th><th>Hadoop2.x</th><th>Hadoop3.x</th></tr></thead><tbody><tr><td>NameNode内部通信端口</td><td>8020 / 9000</td><td>8020 / 9000/9820</td></tr><tr><td>NameNode HTTP UI</td><td>50070</td><td>9870</td></tr><tr><td>MapReduce查看执行任务端口</td><td>8088</td><td>8088</td></tr><tr><td>历史服务器通信端口</td><td>19888</td><td>19888</td></tr></tbody></table><h3 id="_3-2-11-集群时间同步" tabindex="-1"><a class="header-anchor" href="#_3-2-11-集群时间同步" aria-hidden="true">#</a> 3.2.11 集群时间同步</h3><p>如果服务器在公网环境（能连接外网），可以不采用集群时间同步，因为服务器会定期和公网时间进行校准；</p><p>如果服务器在内网环境，必须要配置集群时间同步，否则时间久了，会产生时间偏差，导致集群执行任务时间不同步。</p><p>1）需求</p><p>找一个机器，作为时间服务器，所有的机器与这台集群时间进行定时的同步，生产环境根据任务对时间的准确程度要求周期同步。测试环境为了尽快看到效果，采用1分钟同步一次。</p><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119020126.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>2）时间服务器配置（必须root用户）</p><p>（1）查看所有节点ntpd服务状态和开机自启动状态</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl status ntpd
<span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl start ntpd
<span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl is-enabled ntpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）修改hadoop102的ntp.conf配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/ntp.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改内容如下</p><p>（a）修改1（授权192.168.10.0-192.168.10.255网段上的所有机器可以从这台机器上查询和同步时间）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#restrict 192.168.10.0 mask 255.255.255.0 nomodify notrap</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>为</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>restrict <span class="token number">192.168</span>.10.0 mask <span class="token number">255.255</span>.255.0 nomodify notrap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（b）修改2（集群在局域网中，不使用其他互联网上的时间）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>server <span class="token number">0</span>.centos.pool.ntp.org iburst
server <span class="token number">1</span>.centos.pool.ntp.org iburst
server <span class="token number">2</span>.centos.pool.ntp.org iburst
server <span class="token number">3</span>.centos.pool.ntp.org iburst
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#server 0.centos.pool.ntp.org iburst</span>
<span class="token comment">#server 1.centos.pool.ntp.org iburst</span>
<span class="token comment">#server 2.centos.pool.ntp.org iburst</span>
<span class="token comment">#server 3.centos.pool.ntp.org iburst</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（c）添加3（当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中的其他节点提供时间同步）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>server <span class="token number">127.127</span>.1.0
fudge <span class="token number">127.127</span>.1.0 stratum <span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）修改hadoop102的/etc/sysconfig/ntpd 文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/sysconfig/ntpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>增加内容如下（让硬件时间与系统时间一起同步）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>SYNC<span class="token punctuation">\\</span>_HWCLOCK<span class="token operator">=</span>yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（4）重新启动ntpd服务</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl start ntpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（5）设置ntpd服务开机启动</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> ntpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）其他机器配置（必须root用户）</p><p>（1）关闭所有节点上ntp服务和自启动</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl stop ntpd
<span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl disable ntpd
<span class="token punctuation">[</span>atguigu@hadoop104 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl stop ntpd
<span class="token punctuation">[</span>atguigu@hadoop104 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl disable ntpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）在其他机器配置1分钟与时间服务器同步一次</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">crontab</span> <span class="token parameter variable">-e</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>编写定时任务如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>*/1 * * * * /usr/sbin/ntpdate hadoop102
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（3）修改任意机器时间</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">&quot;2021-9-11 11:11:11&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（4）1分钟后查看机器是否与时间服务器同步</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop103 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">date</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,56);function h(f,x){const n=o("ExternalLinkIcon");return l(),i("div",null,[a("p",null,[s("1）Hadoop官方网站："),a("a",d,[s("http://hadoop.apache.org/"),e(n)])]),u,a("p",null,[s("（a）浏览器中输入："),a("a",r,[s("http://hadoop103:8088"),e(n)])]),v,a("p",null,[a("a",g,[s("http://hadoop102:19888/jobhistory"),e(n)])]),m,a("p",null,[s("1）Hadoop集群启停脚本（包含HDFS，Yarn，Historyserver）："),a("a",k,[s("myhadoop.sh"),e(n)])]),b])}const _=p(c,[["render",h],["__file","03_Hadoop运行模式.html.vue"]]);export{_ as default};
