import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as n,a as e}from"./app-9a860c23.js";const i={},o=e(`<h2 id="集群操作" tabindex="-1"><a class="header-anchor" href="#集群操作" aria-hidden="true">#</a> 集群操作</h2><h3 id="集群安装" tabindex="-1"><a class="header-anchor" href="#集群安装" aria-hidden="true">#</a> 集群安装</h3><ol><li>集群规划</li></ol><p>在 hadoop102、hadoop103 和 hadoop104 三个节点上都部署 Zookeeper。</p><p>思考：如果是 <em>10 <em>台服务器，需要部署多少台</em>Zookeeper</em>？</p><ol start="2"><li>解压安装</li></ol><ul><li>在 hadoop102 解压Zookeeper 安装包到/opt/module/目录下</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 software<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> apache-zookeeper-3.5.7- bin.tar.gz <span class="token parameter variable">-C</span> /opt/module/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>修改 apache-zookeeper-3.5.7-bin 名称为 zookeeper-3.5.7</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 zookeeper-3.5.7module<span class="token punctuation">]</span><span class="token variable">$mv</span> apache-zookeeper-3.5.7-bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>配置服务器编号</li></ol><ul><li>在/opt/module/zookeeper-3.5.7/这个目录下创建 zkData</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 zookeeper-3.5.7<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> zkData
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>在/opt/module/zookeeper-3.5.7/zkData 目录下创建一个 myid 的文件</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 zkData<span class="token punctuation">]</span>$ <span class="token function">vi</span> myid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在文件中添加与 server 对应的编号（注意：上下不要有空行，左右不要有空格）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：添加 myid 文件，一定要在 Linux 里面创建，在 notepad++里面很可能乱码</p><ul><li>拷贝配置好的 zookeeper 到其他机器上</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 module<span class="token punctuation">]</span>$ xsync zookeeper-3.5.7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>并分别在 hadoop103、hadoop104 上修改 myid 文件中内容为 3、4</p><ol start="4"><li>配置zoo.cfg文件</li></ol><ul><li>重命名/opt/module/zookeeper-3.5.7/conf 这个目录下的 zoo_sample.cfg 为 zoo.cfg</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 conf<span class="token punctuation">]</span>$ <span class="token function">mv</span> zoo_sample.cfg zoo.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>打开zoo.cfg 文件</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 conf<span class="token punctuation">]</span>$ <span class="token function">vim</span> zoo.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改数据存储路径配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/opt/module/zookeeper<span class="token punctuation">\\</span>-3<span class="token punctuation">\\</span>.5<span class="token punctuation">\\</span>.7/zkData
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>增加如下配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#######################cluster##########################</span>
<span class="token assign-left variable">server.2</span><span class="token operator">=</span>hadoop102:2888:3888
<span class="token assign-left variable">server.3</span><span class="token operator">=</span>hadoop103:2888:3888
<span class="token assign-left variable">server.4</span><span class="token operator">=</span>hadoop104:2888:3888
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>配置参数解读<code>server.A=B:C:D</code></p><ul><li><p>A是一个数字，表示这个是第几号服务器；集群模式下配置一个文件myid，这个文件在 dataDir 目录下，这个文件里面有一个数据就是 A 的值，Zookeeper 启动时读取此文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是哪个 server。</p></li><li><p>B是这个服务器的地址；</p></li><li><p>C是这个服务器Follower 与集群中的 Leader 服务器交换信息的端口；</p></li><li><p>D是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。</p></li></ul></li><li><p>同步zoo.cfg 配置文件</p></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 conf<span class="token punctuation">]</span>$ xsync zoo.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>集群操作</li></ol><ul><li>分别启动Zookeeper</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 zookeeper-3.5.7<span class="token punctuation">]</span>$ bin/zkServer.sh start
<span class="token punctuation">[</span>atguigu@hadoop103 zookeeper-3.5.7<span class="token punctuation">]</span>$ bin/zkServer.sh start
<span class="token punctuation">[</span>atguigu@hadoop104 zookeeper-3.5.7<span class="token punctuation">]</span>$ bin/zkServer.sh start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>查看状态</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 zookeeper-3.5.7<span class="token punctuation">]</span><span class="token comment"># bin/zkServer.sh status JMX enabled by default</span>
Using config: /opt/module/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg Mode: follower
<span class="token punctuation">[</span>atguigu@hadoop103 zookeeper-3.5.7<span class="token punctuation">]</span><span class="token comment"># bin/zkServer.sh status JMX enabled by default</span>
Using config: /opt/module/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg Mode: leader
<span class="token punctuation">[</span>atguigu@hadoop104 zookeeper-3.4.5<span class="token punctuation">]</span><span class="token comment"># bin/zkServer.sh status JMX enabled by default</span>
Using config: /opt/module/zookeeper-3.5.7/bin/<span class="token punctuation">..</span>/conf/zoo.cfg Mode: follower
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="选举机制-面试重点" tabindex="-1"><a class="header-anchor" href="#选举机制-面试重点" aria-hidden="true">#</a> 选举机制（面试重点）</h3><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119162500.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://lhplanet-1316168555.cos.ap-beijing.myqcloud.com/obsidian/20231119162523.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="zk集群启动停止脚本" tabindex="-1"><a class="header-anchor" href="#zk集群启动停止脚本" aria-hidden="true">#</a> ZK集群启动停止脚本</h3><ul><li>在hadoop102 的/home/atguigu/bin 目录下创建脚本</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">vim</span> zk.sh	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在脚本中编写如下内容</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
<span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> ---------- zookeeper <span class="token variable">$i</span> 启动 ------------
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> ---------- zookeeper <span class="token variable">$i</span> 停止 ------------
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> hadoop102 hadoop103 hadoop104
    <span class="token keyword">do</span>
        <span class="token builtin class-name">echo</span> ---------- zookeeper <span class="token variable">$i</span> 状态 ------------
        <span class="token function">ssh</span> <span class="token variable">$i</span> <span class="token string">&quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>增加脚本执行权限</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 bin<span class="token punctuation">]</span>$ <span class="token function">chmod</span> u+x zk.sh	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Zookeeper 集群启动脚本</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 module<span class="token punctuation">]</span>$ zk.sh start	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Zookeeper 集群停止脚本</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>atguigu@hadoop102 module<span class="token punctuation">]</span>$ zk.sh stop	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>未完待续...</p></div>`,52),l=[o];function p(t,d){return s(),n("div",null,l)}const r=a(i,[["render",p],["__file","03_Zookeeper集群操作.html.vue"]]);export{r as default};
